# 文件編輯器頁面 UX 規格（更新版）

## 文件編輯器頁面

設計一個功能強大、直觀的 Markdown 編輯器頁面，讓用戶能夠高效地創建和編輯 Markdown 文件，並支持目錄結構和文件管理。

### 視覺設計

- **佈局**：頂部導航欄，麵包屑導航，主要內容區域為編輯器
- **配色**：使用應用的主色調（藍色系）和中性色調（白色、淺灰色背景）
- **字體**：編輯器內使用等寬字體，提高代碼可讀性
- **響應式**：編輯器區域最大化利用可用空間，在小屏幕上簡化工具欄

### 內容元素

1. **頁面頂部欄**：
   - 左側：應用 Logo 和名稱「CoSpec Markdown」
   - 右側：用戶信息區域（用戶名、頭像）和登出按鈕

2. **麵包屑導航**：
   - 「個人空間」 > 「專案」 > 「[專案名稱]」 > 「[目錄路徑]」 > 「[文件名]」
   - 可點擊返回上級頁面

3. **編輯器頂部工具欄**：
   - 左側：
     - 返回按鈕：「← 返回到文件列表」
     - 文件路徑：顯示當前文件的完整路徑
     - 文件名稱：顯示當前文件名
   - 右側：
     - 保存狀態指示器：
       - 保存中：「保存中...」（黃色）
       - 已保存：「已保存於 [時間]」（綠色）
     - 保存按鈕：「保存」
     - 文件操作下拉菜單：
       - 重命名
       - 移動到其他目錄
       - 刪除

4. **CoSpec 編輯器**：
   - 工具欄：
     - 格式化工具：標題、粗體、斜體、刪除線、引用、列表、有序列表、任務列表
     - 插入工具：鏈接、圖片、表格、代碼塊、數學公式
     - 視圖工具：預覽、分屏、全屏
     - 其他工具：撤銷、重做、幫助
   - 編輯區域：
     - 語法高亮
     - 行號顯示（可選）
     - 自動縮進
     - 即時預覽（分屏模式）
   - 側邊欄（可折疊）：
     - 文件大綱：顯示文件的標題結構
     - 專案文件：顯示當前專案的文件樹
     - 搜索：在當前專案中搜索

5. **Git 差異顯示**（如果文件有未提交的更改）：
   - 行級差異標記：
     - 添加的行：綠色背景
     - 修改的行：黃色背景
     - 刪除的行：紅色背景（在編輯器邊緣標記）
   - 差異摘要：顯示添加/修改/刪除的行數
6. **工具欄交互**：
   - 懸停提示：顯示工具名稱和快捷鍵
   - 點擊效果：應用相應的格式化或插入操作
   - 狀態指示：當前激活的格式化選項高亮顯示

7. **麵包屑導航**：
   - 點擊「個人空間」返回個人空間頁面
   - 點擊「專案」返回專案列表頁面
   - 點擊專案名稱返回該專案的根目錄
   - 點擊目錄路徑中的任何部分導航到對應目錄
   - 點擊文件名稱保持在當前頁面

8. **響應式行為**：
   - 小屏幕：簡化工具欄，優先顯示常用工具
   - 中等屏幕：顯示完整工具欄，可能需要滾動

### Markdown 功能支持

1. **基本格式**：
   - 標題（六級）
   - 粗體、斜體、刪除線
   - 引用
   - 有序列表、無序列表
   - 任務列表（複選框）
   - 水平分割線

2. **高級功能**：
   - 代碼塊（支持語法高亮）
   - 表格（支持表格編輯器）
   - 數學公式（支持 KaTeX 或 MathJax）
   - 圖表（支持 Mermaid）
   - 腳註
   - 目錄生成

3. **擴展功能**：
   - 圖片上傳和管理
   - 鏈接自動識別
   - 表情符號選擇器
   - Markdown 快捷鍵

### 狀態和錯誤處理

1. **加載狀態**：
   - 初始加載：顯示加載指示器
   - 大文件加載：顯示進度指示器

2. **錯誤狀態**：
   - 文件不存在：顯示「文件不存在或已被刪除」消息
   - 加載錯誤：顯示「無法加載文件」消息和重試按鈕
   - 保存錯誤：顯示「保存失敗」消息和重試按鈕
   - 權限錯誤：顯示「無權編輯此文件」消息

3. **衝突處理**：
   - 檢測到衝突：顯示衝突解決界面
   - 三向合併視圖：顯示本地版本、遠程版本和基礎版本
   - 衝突解決選項：使用本地版本、使用遠程版本、手動合併

### 輔助功能

1. **鍵盤導航**：
   - 支持所有標準編輯器快捷鍵
   - 支持 Tab 鍵在編輯器內進行縮進
   - 支持自定義快捷鍵

2. **屏幕閱讀器支持**：
   - 為編輯器提供適當的 ARIA 標籤
   - 確保工具欄按鈕有適當的可訪問性標籤
   - 提供編輯器狀態變化的通知

3. **高對比度模式**：
   - 確保在高對比度模式下所有元素仍然清晰可見
   - 提供適合視力障礙用戶的配色方案選項

### 性能考慮

1. **大文件處理**：
   - 實現虛擬滾動，只渲染可見部分
   - 延遲加載大型預覽內容
   - 提供性能模式選項，減少即時預覽頻率

2. **離線支持**：
   - 實現本地保存機制，防止數據丟失
   - 在網絡恢復時自動同步更改

3. **自動保存優化**：
   - 使用防抖動技術減少保存請求
   - 只在內容實際變化時觸發保存
   - 提供保存歷史記錄，支持版本回滾
